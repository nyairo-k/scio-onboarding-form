<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join Our Expert Network</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Join Our Expert Network</h1>
        <form id="expertApplicationForm">
            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" name="fullName" placeholder="Your full name" required>
            </div>

            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" placeholder="name@example.com" required>
            </div>

            <div class="form-group">
                <label for="linkedinUrl">LinkedIn Profile URL</label>
                <input type="url" id="linkedinUrl" name="linkedinUrl" placeholder="https://linkedin.com/in/yourprofile" required>
            </div>

            <div class="form-group">
                <label for="cvFile">Upload Your CV/Resume <span class="accepted-formats">(Accepted formats: .pdf, .doc, .docx)</span></label>
                <input type="file" id="cvFile" name="cvFile" accept=".pdf,.doc,.docx" required>
            </div>

            <div class="form-group">
                <label for="howHeard">How did you hear about us?</label>
                <select id="howHeard" name="howHeard">
                    <option value="">Please select</option>
                    <option value="linkedin">LinkedIn</option>
                    <option value="referral">Referral</option>
                    <option value="google_search">Google Search</option>
                    <option value="event">Event</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Have you worked with SCIO before?</label>
                <div class="radio-group">
                    <input type="radio" id="workedScioYes" name="workedScio" value="true" required>
                    <label for="workedScioYes">Yes</label>
                    <input type="radio" id="workedScioNo" name="workedScio" value="false" required>
                    <label for="workedScioNo">No</label>
                </div>
                <div id="scioProjectDetailsContainer" class="hidden">
                    <label for="scioProjectDetails">Please specify the project or capacity:</label>
                    <textarea id="scioProjectDetails" name="scioProjectDetails" rows="3"></textarea>
                </div>
            </div>

            <div class="consent-box privacy-consent">
                <h2>Data Privacy and Protection</h2>
                <p>By submitting this application, you agree to our <a href="#" target="_blank">Privacy Policy</a> and consent to the collection and processing of your personal data as described therein. This includes your name, contact information, professional experience, and skills extracted from your CV and LinkedIn profile, for the purpose of evaluating your suitability for our expert network and for ongoing engagement as outlined in our workflow.</p>
                <div class="checkbox-group">
                    <input type="checkbox" id="consentDataPrivacy" name="consentDataPrivacy" required>
                    <label for="consentDataPrivacy">I agree to the Data Privacy and Protection policy.</label>
                </div>
            </div>

            <div class="consent-box ai-consent">
                <h2>AI-Powered CV Analysis</h2>
                <p>To efficiently process applications and identify suitable candidates, we utilize Artificial Intelligence to analyze your CV and extract key details such as skills, experience, and qualifications. This process helps us streamline our screening and matching. Your CV data will be handled securely and confidentially. Please note that the AI analysis is an initial screening step and is always followed by a manual review.</p>
                <div class="checkbox-group">
                    <input type="checkbox" id="consentAiAnalysis" name="consentAiAnalysis" required>
                    <label for="consentAiAnalysis">I consent to the AI analysis of my CV.</label>
                </div>
            </div>

            <button type="submit" id="submitButton" disabled>Submit Application</button>
            <p id="consentReminder" class="consent-reminder">Please agree to both terms above to enable submission.</p>
            <p id="submissionMessage" class="submission-message"></p>
        </form>
    </div>


    <!-- Your custom script, now sending to proxy server -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event fired. Frontend logic starting.');

            const form = document.getElementById('expertApplicationForm');
            const submitButton = document.getElementById('submitButton');
            const consentDataPrivacy = document.getElementById('consentDataPrivacy');
            const consentAiAnalysis = document.getElementById('consentAiAnalysis');
            const consentReminder = document.getElementById('consentReminder');
            const workedScioYes = document.getElementById('workedScioYes');
            const workedScioNo = document.getElementById('workedScioNo');
            const scioProjectDetailsContainer = document.getElementById('scioProjectDetailsContainer');
            const submissionMessage = document.getElementById('submissionMessage');

            // IMPORTANT: Replace this with the URL of your deployed proxy server (e.g., from Vercel/Render/Fly.io)
            // For local testing, it might be 'http://localhost:3000/api/submit-application'
            // When deploying the backend, it will be something like 'https://YOUR_PROXY_SERVER_URL.com/api/submit-application'
            const PROXY_SERVER_URL = 'http://localhost:3000/api/submit-application'; // CHANGE THIS FOR DEPLOYMENT!

            function toggleSubmitButton() {
                if (consentDataPrivacy.checked && consentAiAnalysis.checked) {
                    submitButton.disabled = false;
                    consentReminder.style.display = 'none';
                } else {
                    submitButton.disabled = true;
                    consentReminder.style.display = 'block';
                }
            }

            function toggleScioDetails() {
                if (workedScioYes.checked) {
                    scioProjectDetailsContainer.classList.remove('hidden');
                    scioProjectDetailsContainer.querySelector('textarea').setAttribute('required', 'required');
                } else {
                    scioProjectDetailsContainer.classList.add('hidden');
                    scioProjectDetailsContainer.querySelector('textarea').removeAttribute('required');
                }
            }

            consentDataPrivacy.addEventListener('change', toggleSubmitButton);
            consentAiAnalysis.addEventListener('change', toggleSubmitButton);
            workedScioYes.addEventListener('change', toggleScioDetails);
            workedScioNo.addEventListener('change', toggleScioDetails);

            // Initial state
            toggleSubmitButton();
            toggleScioDetails();


            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                submissionMessage.textContent = 'Submitting your application...';
                submissionMessage.style.color = 'black';
                submitButton.disabled = true; // Prevent double submission

                const formData = new FormData();
                formData.append('fullName', document.getElementById('fullName').value);
                formData.append('email', document.getElementById('email').value);
                formData.append('linkedinUrl', document.getElementById('linkedinUrl').value);
                formData.append('cvFile', document.getElementById('cvFile').files[0]);
                formData.append('howHeard', document.getElementById('howHeard').value);
                formData.append('workedScio', document.querySelector('input[name="workedScio"]:checked').value);
                if (document.querySelector('input[name="workedScio"]:checked').value === 'true') {
                    formData.append('scioProjectDetails', document.getElementById('scioProjectDetails').value);
                }
                formData.append('consentDataPrivacy', consentDataPrivacy.checked);
                formData.append('consentAiAnalysis', consentAiAnalysis.checked);

                try {
                    const response = await fetch(PROXY_SERVER_URL, {
                        method: 'POST',
                        body: formData // FormData automatically sets 'Content-Type': 'multipart/form-data'
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        throw new Error(result.error || 'Unknown server error');
                    }

                    submissionMessage.textContent = 'Application submitted successfully! We will be in touch shortly.';
                    submissionMessage.style.color = 'green';
                    form.reset(); // Clear the form
                    toggleSubmitButton(); // Re-disable submit button until consents are checked again
                    toggleScioDetails(); // Hide project details again
                } catch (error) {
                    console.error('Frontend submission error:', error.message);
                    submissionMessage.textContent = `Error submitting application: ${error.message}. Please try again.`;
                    submissionMessage.style.color = 'red';
                } finally {
                    submitButton.disabled = false;
                }
            });
        }); // End of DOMContentLoaded
    </script>
</body>
</html>
